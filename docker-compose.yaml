version: "3.8"

services:
  backstage:
    build:
      context: ./backstage-app
      dockerfile: ../Dockerfile.source
    ports:
      - "7007:7007"
      - "3000:3000"
    environment:
      - PORT=7007
      - NODE_ENV=development
    command:
      [
        "node",
        "packages/backend",
        "--config",
        "app-config.yaml",
        "--config",
        "/app/host/app-config.local.yaml",
      ]
    volumes:
      - ./:/app/host:ro
      - ./solution-config:/app/solution-config:ro
      - ./weather-proxy:/app/weather-proxy:ro
      # Note: app-config.local.yaml is read from the host mount at /app/host (no rebuild needed for edits)

  weather-proxy:
    build: ./weather-proxy
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
